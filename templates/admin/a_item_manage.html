{% extends '../admin/a_layout.html' %}
{% load ui_method %}
{% block css %}
    
{% endblock %}

{% block title %}
商品表            
{% endblock %}
{% block page_header %}
<ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-dashboard"></i> 商品管理</a></li>
</ol>
{% endblock %}

{% block content_title %}

<div class="row">
    <div class="col-md-8">
        <div "row">
            <div class="col-md-8">
                <form action="" method="GET" class="search_input">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="搜索商品名称" name="search_value" value="{{ search_value }}">
                    <span class="input-group-btn">
                        <button class="btn btn-default search_input_btn" type="submit">搜索</button>
                    </span>
                  </div><!-- /input-group -->
                </form>
            </div>
            <div class="col-md-4">

            </div>
        </div>
    </div>
    <div class="col-md-4">
        <a href="/myadmin/add_item/" class="btn btn-info add_item_btn" >添加商品 <span class="glyphicon glyphicon-plus"></span></a>
        <button type="button" class="btn btn-default choose_item">选择全部<span class="glyphicon glyphicon-saved"></span></button>
        <button type="button" class="btn btn-danger delete_item" >删除<span class="glyphicon glyphicon-trash"></span></button>
    </div>
</div>
{% endblock %}

{% block content %}

<div style="overflow: auto; padding: 15px;">
    {% for i in item_list %}
    <div class="panel panel-info item_list">
        <div class="panel-heading"><input type="checkbox" class="item_checkbox" item-id={{i.item_id}}>商品名：{{i.item_name}}</div>
        <div class="panel-body">
            <div class="media-left">
                <a href="#">
                    <img class="media-object" src="{% get_thumbicon_by_id i.item_id %}" style="width: 100px; height: 100px;">
                </a>
            </div>
                <div class="media-body">
                <div class="row">
                    <div class="col-md-4">
                        {{i.item_info}}
                    </div>
                    <div class="col-md-2">
                        <div class="row">
                            现价：{{i.current_price}}
                        </div>
                        <div class="row">
                            原价：{{i.price}}
                        </div>
                        <div class="row">
                            国外价格：{{i.foreign_price}}
                        </div>
                        <div class="row">
                            容量：/规格：{% if i.specifications_type_id %}{% get_value_by_key specifications_type_dict i.specifications_type_id %}{% endif %}
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="row">
                            适用人群：{{i.for_people}}
                        </div>
                        <div class="row">
                            所属品牌：{% if i.brand_id %}{% get_value_by_key brand_dict i.brand_id %}{% endif %}
                        </div>
                        <div class="row">
                            所属分类：{% if i.categories_id %}{% get_value_by_key categories_dict i.categories_id %}{% endif %}
                        </div>
                    </div>
                    <div class="col-md-2">
                            保质期：{{i.shelf_life}}
                    </div>
                    <div class="col-md-2">
                        <div class="row">
                            <a  href="/myadmin/editor_item?item_id={{i.item_id}}&back_url={{request.get_full_path}}" style='cursor:pointer;text-decoration:none;'><span class="glyphicon glyphicon-pencil"></span> 编辑</a>
                        </div>
                        <div class="row">
                            <a href="/myadmin/item_image_manage/?item_id={{i.item_id}}&back_url={{request.get_full_path}}" style='cursor:pointer;text-decoration:none;'><span class="glyphicon glyphicon-picture"></span> 图片管理</a>
                        </div>
                    </div>
                </div>
               
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div>
    <nav aria-label="Page navigation">
        <ul class="pagination page_box">
            {% Pagingfunc current_page item_count filter_args uri as page %}
            {{ page | safe }}
        </ul>
    </nav>
</div>

{% endblock %}
{% block js %}
    <script>
    $(function(){
        $('.items_manage').addClass('active')
        $(".add_item_btn").click(function(){
            $('.modal-title').text('创建商品')
            $('.submit_btn').unbind()
            $('.submit_btn').click(function(){
                add_or_edit_item(false)
            })
        })
        $(".choose_item").click(function(){
            var text =  $(this).text()
            var $item_list = $('.item_list')
            if(text == '选择全部'){
                $item_list.each(function(index, item){
                    var f =  $(item).children().first()
                    $(f).find('input[type="checkbox"]').prop('checked', true)
                })
                $(this).html('取消全部<span class="glyphicon glyphicon-saved"></span>')
            }else{
                $item_list.each(function(index, item){
                    var f =  $(item).children().first()
                    $(f).find('input[type="checkbox"]').prop('checked', false)
                })
                $(this).html('选择全部<span class="glyphicon glyphicon-saved"></span>')
            }
            
        })
        $('.delete_item').click(delete_item)
        $('.edit_item').click(get_edit_item_info)
        $('.image_manage').click()
    })

    function delete_item(){
        var $item_list = $('.item_list')
        var item_id_list = []
        $item_list.each(function(index, item){
            var f =  $(item).children().first().find('input[type="checkbox"]')
            var is_checked = $(f).prop('checked')
            if(is_checked){
                item_id_list.push($(f).attr('item-id'))
            }
        })
        if(item_id_list.length>0){
            $.post(
                '/myadmin/js/delete_items/',
                {'item_id_list':item_id_list, 'csrfmiddlewaretoken':getCookie('csrftoken')},
                function(value){
                    if(value.status == 'success'){
                        location.reload()
                    }else{
                        alert(value.message)
                    }
                },
                'json'
            )
        }
    }
    
    </script>
{% endblock %}